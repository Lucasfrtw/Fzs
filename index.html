<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minha Loja - Checkout Pro</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
            text-align: center;
        }
        .product {
            margin: 20px;
            padding: 20px;
            background-color: white;
            border: 1px solid #ddd;
            display: inline-block;
            text-align: left;
        }
        .product img {
            width: 200px;
            height: 200px;
        }
        .product h2 {
            font-size: 18px;
            margin: 0;
        }
        .buy-button {
            background-color: #ff5722;
            color: white;
            padding: 10px 20px;
            border: none;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <header>
        <h1>Minha Loja Online</h1>
    </header>
    <div class="product">
        <img src="https://via.placeholder.com/200" alt="Produto 1">
        <h2>Produto 1</h2>
        <p>Preço: R$ 50,00</p>
        <button class="buy-button" id="checkout-button">Pagar com Mercado Pago</button>
    </div>

    <!-- SDK do Mercado Pago -->
    <script src="https://sdk.mercadopago.com/js/v2"></script>
    
    <script>
        // A função será acionada quando o botão for clicado
        const checkoutButton = document.getElementById('checkout-button');

        checkoutButton.addEventListener('click', async function () {
            // Fazer requisição ao backend para criar a preferência de pagamento
            try {
                const response = await fetch('https://paymentov-6fe6272f1836.herokuapp.com/create_preference', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json(); // Pega o JSON da resposta do backend

                if (data.id) {
                    const mp = new MercadoPago('APP_USR-4df1793c-768d-48cb-bf21-bb1c9e3c5817', {
                        locale: 'pt-BR'
                    });

                    // Abre o Checkout Pro com o preference_id gerado
                    mp.checkout({
                        preference: {
                            id: data.id // O preference_id gerado no backend
                        },
                        autoOpen: true // Abre automaticamente o checkout
                    });
                } else {
                    console.error('Erro ao criar preferência');
                }

            } catch (error) {
                console.error('Erro ao conectar com o backend:', error);
            }
        });
    </script>
</body>
</html>
